<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#58CC02">
  <title>LinguaKids - Hindi Progress & Achievements</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Quicksand', Arial, sans-serif;
      background: linear-gradient(135deg,#e0eaff 0%,#f6f0ff 100%);
      margin:0;padding:0;
      min-height: 100vh;
    }
    #app { max-width:1000px; margin:auto; padding:15px; }
    h2 { text-align:center; color:#58cc02; font-family:'Baloo 2',cursive; }
    
    .dashboard {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
    
    .streak-container {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    .streak-box {
      background: linear-gradient(to right,#ff9a00,#ff6a00);
      color: white;
      padding: 10px 20px;
      border-radius: 50px;
      font-family:'Baloo 2',cursive;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .progress-section {
      margin: 20px 0;
    }
    
    .progress-bar {
      height: 20px;
      background: #f0f0f0;
      border-radius: 10px;
      margin: 10px 0;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(to right,#58cc02,#1cb0f6);
      border-radius: 10px;
      width: 0%;
      transition: width 0.5s ease;
      text-align: center; 
      color: white; 
      font-weight: bold; 
      font-size: 0.9rem; 
      line-height: 20px;
    }
    
    .achievements-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .achievement-card {
      background: white;
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      transition: 0.3s;
      cursor: pointer;
    }
    
    .achievement-card.locked {
      filter: grayscale(1);
      opacity: 0.7;
    }
    
    .achievement-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
    }
    
    .achievement-icon {
      font-size: 2rem;
      margin-bottom: 10px;
    }
    
    .achievement-title {
      font-weight: bold;
      font-size: 0.9rem;
    }
    
    .achievement-desc {
      font-size: 0.8rem;
      color: #666;
    }
    
    .btn {
      background:linear-gradient(to right,#58cc02,#1cb0f6);
      border:none; color:white; padding:8px 20px; border-radius:50px;
      font-family:'Baloo 2',cursive; cursor:pointer; margin:10px 5px;
      text-decoration: none;
      display: inline-block;
      transition: all 0.3s;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .btn:active { transform:scale(0.96); }
    
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #58cc02;
      color: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
      transform: translateY(100px);
      opacity: 0;
      transition: transform 0.3s, opacity 0.3s;
    }
    
    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    /* Custom Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
      max-width: 90%;
      width: 400px;
      text-align: center;
      font-family: 'Quicksand', sans-serif;
    }

    .modal-content p {
      font-size: 1.1rem;
      margin-bottom: 25px;
      color: #333;
    }

    .modal-actions .btn {
      padding: 10px 20px;
      font-size: 1rem;
      margin: 0 10px;
    }

    .btn-danger {
      background: linear-gradient(to right, #ff6b6b, #ff5252);
    }
    
    .progress-details {
      display: none; /* This line hides the detailed progress text */
    }
    
    .category-progress {
      display: flex;
      justify-content: space-between;
      margin: 5px 0;
    }
    
    @media(max-width:600px){
      .achievements-grid {
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      }
      
      .modal-content {
        width: 90%;
        padding: 20px;
      }
    }
  </style>
</head>
<body>
<div id="app">
  <div style="text-align:left; margin-bottom:10px;">
    <button class="btn" onclick="goBackHome()">Back</button>
  </div>
  
  <h2>My Progress</h2>
  
  <div class="dashboard">
    <div class="streak-container">
      <div class="streak-box">
        <i class="fas fa-fire"></i>
        <span id="streakCount">0</span> ‡§¶‡§ø‡§® ‡§ï‡•Ä ‡§≤‡§ó‡§æ‡§§‡§æ‡§∞ ‡§∏‡•Ä‡§ñ (Day Streak)
      </div>
    </div>
    
    <div class="progress-section">
      <h3>Level Progress</h3>
      
      <div>
        <span>Level 1: Alphabets & Numbers</span>
        <div class="progress-bar">
          <div class="progress-fill" id="level1Progress"></div>
        </div>
        <div class="progress-details" id="level1Details"></div>
      </div>
      
      <div>
        <span>Level 2: Basic Words</span>
        <div class="progress-bar">
          <div class="progress-fill" id="level2Progress"></div>
        </div>
        <div class="progress-details" id="level2Details"></div>
      </div>
      
      <div>
        <span>Level 3: Sentences & Expressions</span>
        <div class="progress-bar">
          <div class="progress-fill" id="level3Progress"></div>
        </div>
        <div class="progress-details" id="level3Details"></div>
      </div>
      
      <div>
        <span>Games</span>
        <div class="progress-bar">
          <div class="progress-fill" id="gamesProgress"></div>
        </div>
        <div class="progress-details" id="gamesDetails"></div>
      </div>
    </div>
    
    <div class="progress-section">
      <h3>Achievements</h3>
      <div class="achievements-grid" id="achievementsContainer">
        </div>
    </div>
  
  <div style="text-align: center; margin-top: 20px;">
    <button class="btn" onclick="loadHindiLevel1()">Continue Learning</button>
    <button class="btn btn-danger" onclick="resetProgress()">Reset Progress</button>
  </div>
</div>

<div id="achievementToast" class="toast">
  <i class="fas fa-trophy"></i>
  <div>
    <div id="toastTitle">‡§â‡§™‡§≤‡§¨‡•ç‡§ß‡§ø ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§! (Achievement Unlocked!)</div>
    <div id="toastDesc">You've earned a new badge.</div>
  </div>
</div>

<div id="customResetModal" class="modal-overlay">
  <div class="modal-content">
    <p id="modalMessage">All your progress will be reset. Are you sure you want to continue?</p>
    <div class="modal-actions">
      <button class="btn btn-danger" onclick="performReset()">Yes, Reset</button>
      <button class="btn" onclick="document.getElementById('customResetModal').style.display='none'">Cancel</button>
    </div>
  </div>
</div>

<script>
// === DATA CONSTANTS ===
const VOWELS_LENGTH = 12;
const CONSONANTS_LENGTH = 37;
const NUMBERS_1_TO_100_LENGTH = 100;
const LEVEL2_CATEGORY_LENGTH = 10;
const LEVEL3_CATEGORY_LENGTH = 10;
const GAMES_LENGTHS = {
  'fill-blanks': 5,
  'match-words': 2,
  'count-apples': 5
};

// Map lowercase internal IDs to display names
const DISPLAY_NAMES = {
    'fruits': 'Fruits',
    'vegetables': 'Vegetables',
    'animals': 'Animals',
    'birds': 'Birds',
    'vehicles': 'Vehicles',
    'colors': 'Colors',
    'greetings': 'Greetings',
    'activities': 'Daily Activities',
    'questions': 'Simple Q&A',
    'fill-blanks': 'Fill-in-Blanks',
    'match-words': 'Match Words',
    'count-apples': 'Count Apples'
};

function formatCategoryName(key) {
    return DISPLAY_NAMES[key] || key.charAt(0).toUpperCase() + key.slice(1);
}

// === Hindi Progress Tracking System (CORRECTED) ===

function initHindiProgress() {
  let progress = JSON.parse(localStorage.getItem('linguaKidsHindiProgress'));
  if (!progress) {
    const defaultProgress = {
      level1: {
        alphabets: { completed: 0, total: VOWELS_LENGTH + CONSONANTS_LENGTH },
        numbers: { completed: 0, total: NUMBERS_1_TO_100_LENGTH }
      },
      level2: {
        fruits: { completed: 0, total: LEVEL2_CATEGORY_LENGTH },
        vegetables: { completed: 0, total: LEVEL2_CATEGORY_LENGTH },
        animals: { completed: 0, total: LEVEL2_CATEGORY_LENGTH },
        birds: { completed: 0, total: LEVEL2_CATEGORY_LENGTH },
        vehicles: { completed: 0, total: LEVEL2_CATEGORY_LENGTH },
        colors: { completed: 0, total: LEVEL2_CATEGORY_LENGTH }
      },
      level3: {
        greetings: { completed: 0, total: LEVEL3_CATEGORY_LENGTH },
        activities: { completed: 0, total: LEVEL3_CATEGORY_LENGTH },
        questions: { completed: 0, total: LEVEL3_CATEGORY_LENGTH }
      },
      games: {
        'fill-blanks': { completed: 0, total: GAMES_LENGTHS['fill-blanks'] },
        'match-words': { completed: 0, total: GAMES_LENGTHS['match-words'] },
        'count-apples': { completed: 0, total: GAMES_LENGTHS['count-apples'] }
      },
      achievements: {
        firstSteps: false, alphabetMaster: false, numberWhiz: false,
        wordExpert: false, sentenceBuilder: false, gameChampion: false,
        weekStreak: false, monthStreak: false
      },
      streak: { count: 0, lastDate: null },
      sessionDate: null
    };
    localStorage.setItem('linguaKidsHindiProgress', JSON.stringify(defaultProgress));
    console.log("Created new Hindi progress data");
    progress = defaultProgress;
  }
  return progress;
}

function updateHindiStreak(progress) {
  const today = new Date().toISOString().slice(0,10); // safer format

  if (progress.sessionDate !== today) {
    let lastDate = progress.streak.lastDate ? new Date(progress.streak.lastDate) : null;
    const todayDate = new Date();

    if (lastDate) {
      const diffTime = todayDate.getTime() - lastDate.getTime();
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
      
      if (diffDays === 1) {
        progress.streak.count++;
      } else if (diffDays > 1) {
        progress.streak.count = 1;
      }
    } else {
      // First ever session ‚Üí start streak at 1
      progress.streak.count = 1;
    }

    progress.streak.lastDate = today;
    progress.sessionDate = today;
    localStorage.setItem('linguaKidsHindiProgress', JSON.stringify(progress));
  }

  return progress;
}


function checkAllAchievements(progress) {
  let earnedAnyAchievement = false;
  
  if (progress.streak.count >= 7 && !progress.achievements.weekStreak) {
    progress.achievements.weekStreak = true; earnedAnyAchievement = true;
    showAchievementToast("7-Day Streak!", "You've practiced for 7 days in a row!");
  }
  if (progress.streak.count >= 30 && !progress.achievements.monthStreak) {
    progress.achievements.monthStreak = true; earnedAnyAchievement = true;
    showAchievementToast("30-Day Streak!", "You're a dedicated learner!");
  }
  
  const level1Completed = progress.level1.alphabets.completed + progress.level1.numbers.completed;
  if (level1Completed > 0 && !progress.achievements.firstSteps) {
    progress.achievements.firstSteps = true; earnedAnyAchievement = true;
    showAchievementToast("First Steps!", "You've started your learning journey!");
  }
  
  const alphabetProgress = progress.level1.alphabets.completed / progress.level1.alphabets.total;
  if (alphabetProgress >= 0.8 && !progress.achievements.alphabetMaster) {
    progress.achievements.alphabetMaster = true; earnedAnyAchievement = true;
    showAchievementToast("Alphabet Master!", "You've learned 80% of alphabets!");
  }
  
  if (progress.level1.numbers.completed >= 50 && !progress.achievements.numberWhiz) {
    progress.achievements.numberWhiz = true; earnedAnyAchievement = true;
    showAchievementToast("Number Whiz!", "You've learned 50 numbers!");
  }
  
  const wordCategoriesCompleted = Object.values(progress.level2).filter(cat => cat.completed >= cat.total).length;
  if (wordCategoriesCompleted >= 3 && !progress.achievements.wordExpert) {
    progress.achievements.wordExpert = true; earnedAnyAchievement = true;
    showAchievementToast("Word Expert!", "You've mastered 3 word categories!");
  }
  
  const sentenceCategoriesCompleted = Object.values(progress.level3).filter(cat => cat.completed >= cat.total).length;
  if (sentenceCategoriesCompleted >= 2 && !progress.achievements.sentenceBuilder) {
    progress.achievements.sentenceBuilder = true; earnedAnyAchievement = true;
    showAchievementToast("Sentence Builder!", "You've completed 2 sentence categories!");
  }
  
  const gamesWithProgress = Object.values(progress.games).filter(game => game.completed > 0).length;
  if (gamesWithProgress >= 2 && !progress.achievements.gameChampion) {
    progress.achievements.gameChampion = true; earnedAnyAchievement = true;
    showAchievementToast("Game Champion!", "You've played 2 different games!");
  }
  
  if (earnedAnyAchievement) {
    localStorage.setItem('linguaKidsHindiProgress', JSON.stringify(progress));
  }
  
  return progress;
}

function showAchievementToast(title, description) {
  const toast = document.getElementById("achievementToast");
  if (!toast) return;
  toast.querySelector("#toastTitle").textContent = title;
  toast.querySelector("#toastDesc").textContent = description;
  toast.classList.add("show");
  setTimeout(() => { toast.classList.remove("show"); }, 3000);
}

// === Progress Display Functions ===

function displayHindiProgress() {
  let progress = initHindiProgress();
  progress = updateHindiStreak(progress);
  progress = checkAllAchievements(progress);
  
  document.getElementById('streakCount').textContent = progress.streak.count;

  // Level 1
  const level1Completed = progress.level1.alphabets.completed + progress.level1.numbers.completed;
  const level1Total = progress.level1.alphabets.total + progress.level1.numbers.total;
  const level1Percent = level1Total > 0 ? Math.round((level1Completed / level1Total) * 100) : 0;
  document.getElementById('level1Progress').style.width = level1Percent + '%';
  document.getElementById('level1Progress').textContent = level1Percent + '%';
  document.getElementById('level1Details').innerHTML = `
    <div class="category-progress"><span>Alphabets: ${progress.level1.alphabets.completed}/${progress.level1.alphabets.total}</span></div>
    <div class="category-progress"><span>Numbers: ${progress.level1.numbers.completed}/${progress.level1.numbers.total}</span></div>`;

  // Level 2
  let level2CompletedTotal = 0, level2PossibleTotal = 0, level2DetailsHtml = '';
  Object.keys(progress.level2).forEach(cat => {
    level2CompletedTotal += progress.level2[cat].completed;
    level2PossibleTotal += progress.level2[cat].total;
    level2DetailsHtml += `<div class="category-progress"><span>${formatCategoryName(cat)}: ${progress.level2[cat].completed}/${progress.level2[cat].total}</span></div>`;
  });
  const level2Percent = level2PossibleTotal > 0 ? Math.round((level2CompletedTotal / level2PossibleTotal) * 100) : 0;
  document.getElementById('level2Progress').style.width = level2Percent + '%';
  document.getElementById('level2Progress').textContent = level2Percent + '%';
  document.getElementById('level2Details').innerHTML = level2DetailsHtml;

  // Level 3
  let level3CompletedTotal = 0, level3PossibleTotal = 0, level3DetailsHtml = '';
  Object.keys(progress.level3).forEach(cat => {
    level3CompletedTotal += progress.level3[cat].completed;
    level3PossibleTotal += progress.level3[cat].total;
    level3DetailsHtml += `<div class="category-progress"><span>${formatCategoryName(cat)}: ${progress.level3[cat].completed}/${progress.level3[cat].total}</span></div>`;
  });
  const level3Percent = level3PossibleTotal > 0 ? Math.round((level3CompletedTotal / level3PossibleTotal) * 100) : 0;
  document.getElementById('level3Progress').style.width = level3Percent + '%';
  document.getElementById('level3Progress').textContent = level3Percent + '%';
  document.getElementById('level3Details').innerHTML = level3DetailsHtml;

  // Games
  let gamesCompletedTotal = 0, gamesPossibleTotal = 0, gamesDetailsHtml = '';
  Object.entries(progress.games).forEach(([gameName, gameData]) => {
    gamesCompletedTotal += gameData.completed;
    gamesPossibleTotal += gameData.total;
    gamesDetailsHtml += `<div class="category-progress"><span>${formatCategoryName(gameName)}: ${gameData.completed}/${gameData.total}</span></div>`;
  });
  const gamesPercent = gamesPossibleTotal > 0 ? Math.round((gamesCompletedTotal / gamesPossibleTotal) * 100) : 0;
  document.getElementById('gamesProgress').style.width = gamesPercent + '%';
  document.getElementById('gamesProgress').textContent = gamesPercent + '%';
  document.getElementById('gamesDetails').innerHTML = gamesDetailsHtml;
  
  displayHindiAchievements(progress.achievements);
}

function displayHindiAchievements(achievements) {
  const achievementsData = [
    { id: 'firstSteps', icon: 'fa-baby', title: '‡§™‡§π‡§≤‡•á ‡§ï‡§¶‡§Æ (First Steps)', desc: 'Complete your first activity', color: '#FF6B6B' },
    { id: 'alphabetMaster', icon: 'fa-font', title: '‡§Ö‡§ï‡•ç‡§∑‡§∞ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û (Alphabet Master)', desc: 'Learn 80% of alphabets', color: '#4ECDC4' },
    { id: 'numberWhiz', icon: 'fa-calculator', title: '‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û (Number Whiz)', desc: 'Learn 50 numbers', color: '#FFD166' },
    { id: 'wordExpert', icon: 'fa-book', title: '‡§∂‡§¨‡•ç‡§¶ ‡§µ‡§ø‡§∂‡•á‡§∑‡§ú‡•ç‡§û (Word Expert)', desc: 'Master 3 word categories', color: '#06D6A0' },
    { id: 'sentenceBuilder', icon: 'fa-comment', title: '‡§µ‡§æ‡§ï‡•ç‡§Ø ‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§§‡§æ (Sentence Builder)', desc: 'Complete 2 parts of Level 3', color: '#118AB2' },
    { id: 'gameChampion', icon: 'fa-gamepad', title: '‡§ñ‡•á‡§≤ ‡§ö‡•à‡§Ç‡§™‡§ø‡§Ø‡§® (Game Champion)', desc: 'Finish 2 games', color: '#EF476F' },
    { id: 'weekStreak', icon: 'fa-fire', title: '7-‡§¶‡§ø‡§® ‡§ï‡•Ä ‡§≤‡§ó‡§æ‡§§‡§æ‡§∞ ‡§∏‡•Ä‡§ñ (7-Day Streak)', desc: 'Practice for 7 consecutive days', color: '#FF9E00' },
    { id: 'monthStreak', icon: 'fa-fire', title: '30-‡§¶‡§ø‡§® ‡§ï‡•Ä ‡§≤‡§ó‡§æ‡§§‡§æ‡§∞ ‡§∏‡•Ä‡§ñ (30-Day Streak)', desc: 'Practice for 30 consecutive days', color: '#FF5400' }
  ];
  
  const container = document.getElementById('achievementsContainer');
  container.innerHTML = achievementsData.map(ach => `
      <div class="achievement-card ${achievements[ach.id] ? '' : 'locked'}" 
           onclick="showAchievementDetail('${ach.id}', ${achievements[ach.id]}, '${ach.title}', '${ach.desc}')">
        <div class="achievement-icon" style="color: ${achievements[ach.id] ? ach.color : '#ccc'}">
          <i class="fas ${ach.icon}"></i>
        </div>
        <div class="achievement-title">${ach.title}</div>
        <div class="achievement-desc">${ach.desc}</div>
      </div>
    `).join('');
}

function showAchievementDetail(achievementId, isUnlocked, title, description) {
  if (isUnlocked) {
    alert(`üéâ ${title}\n\n${description}\n\nYou've unlocked this achievement!`);
  } else {
    alert(`üîí ${title}\n\n${description}\n\nKeep learning to unlock this achievement!`);
  }
}

function goBackHome() {
  window.location.href = "hindi.html";
}

function loadHindiLevel1() {
  window.location.href = "hindi.html";
}

function resetProgress() {
  document.getElementById('customResetModal').style.display = 'flex';
}

function performReset() {
  localStorage.removeItem('linguaKidsHindiProgress');
  sessionStorage.clear();
  document.getElementById('customResetModal').style.display = 'none';
  displayHindiProgress();
}

document.addEventListener('DOMContentLoaded', displayHindiProgress);
</script>
</body>
</html>